<p>すみません、鳥頭なのでコメントしたことをすっかり忘れてしまっていました…m(__)m<br>
修正ありがとうございます！</p>

<blockquote>
<p><code>capacity()</code> で -1 しているのは、内部で <code>__get_long_cap()</code> （NULL 含むキャパシティ取得）単体で使うケースと <code>capacity()</code> （NULL 含まないキャパシティ取得）単体で使うケースを考えると、これでいいんじゃないかなと思います。</p>
</blockquote>

<p>確かにその通りなのですが、ソース見ると <code>__set_long_cap()</code> 関数の呼び出し元で +1 調整してる箇所の方が +1 調整してない箇所よりも多いんですよね。<br>
そして、<code>__set_long_cap()</code> に渡す際の値は必ず偶数で、<code>__set_long_cap()</code> 関数の内部では 1 と or してるので <code>__cap_</code> は必ず奇数になる、つまり内部でまた +1 しているのと同じなので、結局ほとんどのケースで +2 してる、と言う…</p>

<p>だったら、<code>__cap_</code> には <code>capacity()</code> と同じ値を入れておいて（それで必ず奇数になるので）、ホントの領域サイズが必要な箇所だけ <code>__get_long_cap()</code> 関数を呼び出した側で +1 したほうがスッキリするじゃん、と…</p>

<p>＃関係ないけど、再開 bit って何だよ…＞オレ</p>
